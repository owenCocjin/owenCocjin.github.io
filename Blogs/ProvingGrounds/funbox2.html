<html>
<head>
	<title>Proving Grounds: Funbox 2</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/CSS/blog.css">
	<link rel="stylesheet" href="/CSS/global.css">
</head>
<body class="noselect">
	<h1 id="title" class="blog_title">
		<a href="/index.html" class="homelink">
			Proving Grounds: Funbox 2
		</a>
		
	</h1>
	<div id="big_wrapper" class="wordwrap">
		<div class="paragraph">
			<span id="menu_button" class="menu_item">...</span>
			<div id="menu">
				<a href="/index.html" class="menu_item">Home</a>
				<a href="/Blogs/TLDR/funbox2.html" class="menu_item">TLDR</a>
				<a href="/Blogs/index.html" class="menu_item">All Blogs</a>
				<a href="/Blogs/resources.html" class="menu_item">Resources</a>
			</div>
			<hr>
		</div>

<div class="paragraph">
	<p None class="subtitle">Intro:</p>
<p class="content">This box was a straightforward beginner box, good way to practice password cracking. There's plenty of rabbit holes to watch out for!</p>
</div>
<div class="paragraph">
	<p None class="subtitle">Recon: </p>
<p class="content">We start with the new and improved nmap scan: <span class="code">nmap -sT -A -v -n &lt;ip&gt;/24 -p -</span>. The biggest change we've made is we now scan all ports (<span class="code">-p -</span>) because I've been screwed over more times than I'd like to admit when a vital port isn't in nmap's default 1000. Nmap returns ports [21, 22, 80].</p>
<p class="content">FTP was running ProFTPD v1.3.5e, which has a critical vulnerability. It also allows anonymous login.</p>
<p class="content">The web server has a default "Apache 2 It Works!" page. We can immediately check robots.txt, which reveals a /logs/ directory. Navigating to it shows that it doesn't even exist.</p>
</div>
<div class="paragraph">
	<p None class="subtitle">Checking out FTP:</p>
<p class="content">First and foremost, we login anonymously and see that the root is filled with zip files following the naming convention: &ltuser's name&gt.zip. Being overwhelmed by the thought of having to check every zip, we check for vulns in this server's version and come back to this later.</p>
<p class="content">Exploit-DB reveals a critical vulnerability that can potentially allow code execution <a href="#ref_1" class="link">[1]</a>! After a couple of attempts, I wasn't able to successfully execute this exploit. The commands were not agreeing with me and I wasn't able to escape the FTP's root.</p>
<p class="content">Circling back to the zip files, we can download them all, but notice that only one has different permissions than the others: tom.zip. This could've been unintentional and we're just experiencing apophenia, but I digress. Grabbing all files with <span class="code">mget *.zip</span>, we can try to unzip any but are met with a password request for the id_rsa file within. Very promising indeed...</p>
</div>
<div class="paragraph">
	<p None class="subtitle">Cracking the Zips & Getting User:</p>
<p class="content">We can extract the zip's hashes using zip2john:</p>
<div class="content code_block_wrapper"><span class="code_block">for&nbspz&nbspin&nbsp$(ls&nbsp*.zip);&nbspdo<br>
&nbsp&nbspzip2john&nbsp${z}&nbsp&gt;&gt;&nbspwholehashes.txt<br>
&nbsp&nbspcut&nbsp-d&nbsp':'&nbsp-f&nbsp2&nbspwholehashes.txt&nbsp&gt;&gt;&nbsphashes.txt<br>
done</span></div><br class="code_block_br">
<p class="content">Now that we have the hashes (pkzip2) in a file, we can crack them with hashcat: <span class="code">hashcat -a 0 -m 17220 hashes.txt &lt;wordlist&gt;</span>. We get 2 hits: catwoman and iubire. Unfortunately, we don't have any easy way to match these to their respectful zips without a little janky scripting:</p>
<div class="content code_block_wrapper"><span class="code_block">for&nbspi&nbspin&nbsp$(hashcat&nbsp-m&nbsp17220&nbsp--show&nbsphashes.txt);&nbspdo<br>
&nbsp&nbspecho&nbsp-n&nbsp"$(cut&nbsp-d&nbsp':'&nbsp-f&nbsp2&nbsp&lt;&lt;&lt;&nbsp${i}):&nbsp"<br>
&nbsp&nbspgrep&nbsp$(cut&nbsp-d&nbsp'*'&nbsp-f&nbsp14&nbsp&lt;&lt;&lt;&nbsp${i})&nbspwholehashes.txt&nbsp|&nbspcut&nbsp-d&nbsp':'&nbsp-f&nbsp4<br>
done</span></div><br class="code_block_br">
<div class="image imgzoom"><img src="./Pics/hashcat_ran.png"><p class="imgsub">Hashcat completed session. Note the "Recovered" line is 2/3</p></div>
<div class="image imgzoom"><img src="./Pics/hashcat_script_results.png"><p class="imgsub">Matching Hashcat's results with out hashes</p></div>
<p class="content">This shows us that:</p>
<ul class="content"><li>cathrine.zip <- catwoman</li><li>tom.zip <- iubire</li></ul>
<p class="content">An alternative to hashcat is John the Ripper, which is slightly easier to use in this case. We will use the "wholehashes.txt" file generated in the first command: <span class="code">john --wordlist=&lt;wordlist&gt; wholehashes.txt</span>. To print our results: <span class="code">john --show wholehashes.txt</span>. The string after the first colon is the password.</p>
<div class="image imgzoom"><img src="./Pics/john_results.png"><p class="imgsub">John's somewhat discrete results</p></div>
<p class="content">Finally, we can unzip Cathrine and Tom's respective private keys and SSH into the box! I added each person's name as extension to distinguish each user's key. Cathrine doesn't even exist, so it turns out our theory about Tom's zip permissions might have been valid! Logging in using <span class="code">ssh tom@&lt;ip&gt; -i id_rsa.tom</span> yields us access to the box and one bug closer to the goal!</p>
</div>
<div class="paragraph">
	<p None class="subtitle">Getting Root:</p>
<p class="content">The first thing to check are sudo permissions. The issue we face is that we don't have tom's password to allow us to run sudo. Looking around his home directory, we see ".bash_history" and ".mysql_history". Neither are redirected to "/dev/null", and both have content. Bash history has nothing useful, but MySQL has captured some credentials. Specifically, it's captured Tom adding his login credentials into the database! We can try looking around the db which is running on local port 3306, but there is nothing of interest in it.</p>
<div class="image"><img src="./Pics/tom_sql_history.png"><p class="imgsub">Exposing Tom's insecure history (Last line)</p></div>
<div class="image imgzoom"><img src="./Pics/empty_table.png"><p class="imgsub">A sad, empty SQL table</p></div>
<p class="content">Thanks to recycled credentials, we can check Tom's sudo permissions and what do you know? We have permissions for all commands! A simple <span class="code">sudo bash</span> gives us a root shell and a pretty sleek root flag at "/root/flag.txt"!</p>
<div class="image"><img src="./Pics/sudo_shell_flag.png"><p class="imgsub">Going straight to root's flag!</p></div>
</div>
<br><br><br><div class="paragraph res_list">
	<p class="subtitle">Resources:</p>
<p class="content"><a id="ref_1" href="https://www.exploit-db.com/exploits/36742" class="menu_item" target="_blank">ProFTPD 1.3.5 Exploit</a>&nbsp<b>[EXTERNAL]</b></p><br>
</div>
		<br>
		<div class="paragraph">
			<hr>
			<p class="content">Last edit: 2021.09.30</p>
		</div>
	</div>
</body>
<footer>
	<script type="text/javascript" src="/JS/blog.js"></script>
</footer>
</html>